import {extendObservable, observable} from "mobx";

describe('DataSource/Model', () => {
    it('starts at 0', () => {

        const m = model({id: 123, name: 'Test'});
        // const m = new Model({id: 123, name: 'Test'});
        expect(m.isDirty()).toBeFalsy();
        expect(m.isNew()).toBeFalsy();
        expect(m.name).toBe('Test');
    });

    it('should model success', function () {

        const obj2 = {id: 123, name: 'Test', get age() {return 34}, job: 'sexy'};

        Object.defineProperty(obj2, 'job', {
            writable: false,
        });
        const m = modelFactory(obj2);

        m.job = "342";
        m.name = "ss";
        expect(m.id).toBe(obj2.id);
        expect(m.isDirty()).toBeTruthy();
        expect(m.job).toBe("sexy");
    });

    it('should init model', function () {
        const obj = {id: 123, name: 'Test', get model2() {return "889"}};
        const obj2 = {id: 123, name: 'Test', get model2() {return "888"}};

        const obj1 = model(obj);
        const a = model(obj) as any;
        const modelProp = obj1[MODEL];

        const obj3 = observable(obj2);
        const obj4 = createViewModel(obj3);
        a.test = 444;
        // obj1.aaa = "ddd";
        (obj3 as any).aaa = "ddd";
        extendObservable(obj4, {
            age: 353
        })
        // expect(obj).toBe(obj1);

        obj1.name = 'Test123';

        expect(modelProp.dirtyFields).toBe({name: 'Test'});
    });
});
